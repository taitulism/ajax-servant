<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Ajax Servant - Dev</title>
		<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
	</head>
	<body>

		<!-- <form id="qwe" method="POST" action="/api" enctype="text/plain"> -->
		<!-- <form id="qwe" method="POST" action="/api" enctype="multipart/form-data"> -->
		<form id="qwe" method="POST" action="/api" enctype="application/x-www-form-urlencoded;charset=UTF-8">
			<input id="d1" type="text" name="name" />
			<textarea id="d2" type="text" name="txt" /></textarea>
			<input id="d3" type="hidden" name="qwe" value="qqq" />
			<button id="go" value="click" />GO</button>
		</form>
	<script>
		function id(id) {
			return document.getElementById(id);
		}
		const d1 = id('d1');
		const d2 = id('d2');
		const d3 = id('d3');
		let bound = false;

		function jqrSend() {
			if (bound) {return}
			$("#qwe").submit(function(e) {
				bound = true;

			    var url = "/form";
			    var data = $("#qwe").serialize();

			    console.log(data)

			    $.ajax({
			           type: "POST",
			           url: url,
			           data,
			           success: function(data) {
			               alert(data);
			           }
			         });

			    e.preventDefault();
			});
		}

		function mySend () {
			const dat = `${d1.name}=${d1.value}${d2.name}=${d2.value}${d3.name}=${d3.value}`;

			servant.send({
						// params: ['a','b','c'],
						// qryStr: {a:1, b:2},
						// headers: {asd:4567},
						body: escape(dat)
						// body: 'foo=bar&baz=The+first+line.%0D%0AThe+second+line.%0D%0A'
					})
			// .abort()
		}

	</script>
		
	<script src="ajax-servant.js"></script>
	<script>
	//-------------------------------
		const opts = {
			ctx:{b:2},
			// qryStr: {def: 'DEF'},
			breakCache: 'zzz',
			headers: {
				'Content-type': 'application/x-www-form-urlencoded; charset=UTF-8',
				// 'Content-type': 'application/json;charset=UTF-8',
				// 'Content-type': 'text/plain',
				// qwe:1234
			}


		}
		var servant = new AjaxServant('POST','/api', opts);


		servant
			.on('done', function (response, servant, ajaxEvent) {
				// console.log('load - got a response')
				console.log('this:', this)
				console.log('Response:', response.body)
			})
			.on('abort', (resonse, servant, ajaxEvent) => {
				console.log('aborted')
			})
			.on('err', (resonse, servant, ajaxEvent) => {
				console.log('error')
			})
		;



			
$('#go').on('click', e => {
	e.preventDefault();
	// debugger
	// jqrSend();
	mySend();
});











		// console.log(servant)

			// .on('start', {ctx:1}, function (response, servant, ajaxEvent) {
			// 	console.log('first ("before send")')
			// })


			// .on('abort', function (response, servant, ajaxEvent) {
			// 	console.log('aborted')
			// })

			// .on('error', function (response, servant, ajaxEvent) {
			// 	console.log('error')
			// })

			// .on('end', function (response, servant, ajaxEvent) {
			// 	console.log(3, this)
			// 	console.log('last')
			// })





	//-------------------------------
	</script>
	</body>
</html>